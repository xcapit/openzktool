"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[206],{877:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"advanced/custom-circuits","title":"Custom Circuits","description":"Learn how to create your own zero-knowledge circuits tailored to your specific use case.","source":"@site/docs/advanced/custom-circuits.md","sourceDirName":"advanced","slug":"/advanced/custom-circuits","permalink":"/openzktool/docs/advanced/custom-circuits","draft":false,"unlisted":false,"editUrl":"https://github.com/xcapit/openzktool/tree/main/docs-site/docs/advanced/custom-circuits.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Soroban Contract API","permalink":"/openzktool/docs/api-reference/contract-api"},"next":{"title":"Best Practices","permalink":"/openzktool/docs/advanced/best-practices"}}');var r=i(4848),t=i(8453);const c={sidebar_position:1},o="Custom Circuits",l={},a=[{value:"When to Build Custom Circuits",id:"when-to-build-custom-circuits",level:2},{value:"Circuit Development Workflow",id:"circuit-development-workflow",level:2},{value:"Step 1: Design Your Logic",id:"step-1-design-your-logic",level:2},{value:"Example: Credit Score Verification",id:"example-credit-score-verification",level:3},{value:"Sketch the Circuit",id:"sketch-the-circuit",level:3},{value:"Step 2: Write the Circom Circuit",id:"step-2-write-the-circom-circuit",level:2},{value:"Circuit Components",id:"circuit-components",level:3},{value:"Step 3: Compile the Circuit",id:"step-3-compile-the-circuit",level:2},{value:"Step 4: Generate Trusted Setup Keys",id:"step-4-generate-trusted-setup-keys",level:2},{value:"Option A: Use Powers of Tau (Recommended)",id:"option-a-use-powers-of-tau-recommended",level:3},{value:"Option B: Custom Ceremony",id:"option-b-custom-ceremony",level:3},{value:"Step 5: Test Proof Generation",id:"step-5-test-proof-generation",level:2},{value:"Create Test Input",id:"create-test-input",level:3},{value:"Generate and Verify",id:"generate-and-verify",level:3},{value:"Step 6: Export Soroban Verifier",id:"step-6-export-soroban-verifier",level:2},{value:"Customize the Contract",id:"customize-the-contract",level:3},{value:"Step 7: Deploy to Stellar",id:"step-7-deploy-to-stellar",level:2},{value:"Advanced Techniques",id:"advanced-techniques",level:2},{value:"1. Range Proofs",id:"1-range-proofs",level:3},{value:"2. Set Membership",id:"2-set-membership",level:3},{value:"3. Merkle Tree Verification",id:"3-merkle-tree-verification",level:3},{value:"Optimization Tips",id:"optimization-tips",level:2},{value:"1. Minimize Constraints",id:"1-minimize-constraints",level:3},{value:"2. Use Efficient Components",id:"2-use-efficient-components",level:3},{value:"3. Batch Operations",id:"3-batch-operations",level:3},{value:"Testing Best Practices",id:"testing-best-practices",level:2},{value:"1. Unit Test Components",id:"1-unit-test-components",level:3},{value:"2. Integration Testing",id:"2-integration-testing",level:3},{value:"3. Fuzzing",id:"3-fuzzing",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"1. Soundness",id:"1-soundness",level:3},{value:"2. Underflow/Overflow",id:"2-underflowoverflow",level:3},{value:"3. Input Validation",id:"3-input-validation",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"1. Unconstrained Signals",id:"1-unconstrained-signals",level:3},{value:"2. Division",id:"2-division",level:3},{value:"3. Non-Deterministic Operations",id:"3-non-deterministic-operations",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"custom-circuits",children:"Custom Circuits"})}),"\n",(0,r.jsx)(n.p,{children:"Learn how to create your own zero-knowledge circuits tailored to your specific use case."}),"\n",(0,r.jsx)(n.h2,{id:"when-to-build-custom-circuits",children:"When to Build Custom Circuits"}),"\n",(0,r.jsx)(n.p,{children:"Consider creating a custom circuit when:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Existing templates don't match your requirements"}),"\n",(0,r.jsx)(n.li,{children:"You need to verify unique business logic"}),"\n",(0,r.jsx)(n.li,{children:"You want to optimize for specific constraints"}),"\n",(0,r.jsx)(n.li,{children:"Your use case requires novel privacy guarantees"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"circuit-development-workflow",children:"Circuit Development Workflow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph LR\n    A[Design Logic] --\x3e B[Write Circom]\n    B --\x3e C[Compile Circuit]\n    C --\x3e D[Generate Keys]\n    D --\x3e E[Test Proofs]\n    E --\x3e F[Deploy Verifier]\n    F --\x3e G[Integrate]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-1-design-your-logic",children:"Step 1: Design Your Logic"}),"\n",(0,r.jsx)(n.p,{children:"Define what you want to prove privately."}),"\n",(0,r.jsx)(n.h3,{id:"example-credit-score-verification",children:"Example: Credit Score Verification"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Goal:"})," Prove credit score is above a threshold without revealing exact score."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Private Inputs:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"creditScore"})," - User's actual credit score"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Public Inputs:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"minScore"})," - Minimum required score"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Output:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"scoreValid"})," - 1 if score \u2265 minScore, 0 otherwise"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"sketch-the-circuit",children:"Sketch the Circuit"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Input: creditScore (private)\nInput: minScore (public)\n\nCheck: creditScore >= minScore\nOutput: scoreValid (1 or 0)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-2-write-the-circom-circuit",children:"Step 2: Write the Circom Circuit"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"credit_score.circom"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:'pragma circom 2.0.0;\n\ninclude "circomlib/circuits/comparators.circom";\n\ntemplate CreditScoreVerification() {\n    // Private input\n    signal input creditScore;\n\n    // Public inputs\n    signal input minScore;\n\n    // Output\n    signal output scoreValid;\n\n    // Comparison component (32-bit integers)\n    component gte = GreaterEqThan(32);\n\n    // Check: creditScore >= minScore\n    gte.in[0] <== creditScore;\n    gte.in[1] <== minScore;\n\n    // Output result\n    scoreValid <== gte.out;\n}\n\ncomponent main {public [minScore]} = CreditScoreVerification();\n'})}),"\n",(0,r.jsx)(n.h3,{id:"circuit-components",children:"Circuit Components"}),"\n",(0,r.jsxs)(n.p,{children:["OpenZKTool includes ",(0,r.jsx)(n.code,{children:"circomlib"})," with useful components:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GreaterThan"})}),(0,r.jsx)(n.td,{children:"Compare numbers"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"a > b"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"LessThan"})}),(0,r.jsx)(n.td,{children:"Compare numbers"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"a < b"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"IsEqual"})}),(0,r.jsx)(n.td,{children:"Equality check"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"a == b"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Multiplexer"})}),(0,r.jsx)(n.td,{children:"Conditional selection"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"if a then b else c"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Poseidon"})}),(0,r.jsx)(n.td,{children:"Hash function"}),(0,r.jsx)(n.td,{children:"Hash private data"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ECDSA"})}),(0,r.jsx)(n.td,{children:"Signature verification"}),(0,r.jsx)(n.td,{children:"Verify signatures"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"step-3-compile-the-circuit",children:"Step 3: Compile the Circuit"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create circuits directory\nmkdir -p my-project/circuits\n\n# Copy your circuit\ncp credit_score.circom my-project/circuits/\n\n# Compile\ncircom circuits/credit_score.circom \\\n  --r1cs \\\n  --wasm \\\n  --sym \\\n  --output circuits/build/\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Output:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"credit_score.r1cs"})," - Constraint system"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"credit_score.wasm"})," - Witness calculator"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"credit_score.sym"})," - Symbol table"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-4-generate-trusted-setup-keys",children:"Step 4: Generate Trusted Setup Keys"}),"\n",(0,r.jsx)(n.h3,{id:"option-a-use-powers-of-tau-recommended",children:"Option A: Use Powers of Tau (Recommended)"}),"\n",(0,r.jsx)(n.p,{children:"Use a universal trusted setup:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Download Powers of Tau (one-time)\nwget https://hermez.s3-eu-west-1.amazonaws.com/powersOfTau28_hez_final_15.ptau\n\n# Generate circuit-specific keys\nsnarkjs groth16 setup \\\n  circuits/build/credit_score.r1cs \\\n  powersOfTau28_hez_final_15.ptau \\\n  circuits/build/credit_score_0000.zkey\n\n# Contribute to phase 2 (optional but recommended)\nsnarkjs zkey contribute \\\n  circuits/build/credit_score_0000.zkey \\\n  circuits/build/credit_score_final.zkey \\\n  --name="Your contribution" \\\n  -v\n\n# Export verification key\nsnarkjs zkey export verificationkey \\\n  circuits/build/credit_score_final.zkey \\\n  circuits/build/verification_key.json\n'})}),"\n",(0,r.jsx)(n.h3,{id:"option-b-custom-ceremony",children:"Option B: Custom Ceremony"}),"\n",(0,r.jsx)(n.p,{children:"For production deployments with high security requirements:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Phase 1: Powers of Tau ceremony\nsnarkjs powersoftau new bn128 15 pot15_0000.ptau\nsnarkjs powersoftau contribute pot15_0000.ptau pot15_0001.ptau\n# ... multiple contributors ...\nsnarkjs powersoftau beacon pot15_final.ptau\nsnarkjs powersoftau prepare phase2 pot15_final.ptau prepared.ptau\n\n# Phase 2: Circuit-specific ceremony\nsnarkjs groth16 setup circuits/build/credit_score.r1cs prepared.ptau credit_score_0000.zkey\nsnarkjs zkey contribute credit_score_0000.zkey credit_score_final.zkey\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-5-test-proof-generation",children:"Step 5: Test Proof Generation"}),"\n",(0,r.jsx)(n.h3,{id:"create-test-input",children:"Create Test Input"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"test_input.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "creditScore": "720",\n  "minScore": "650"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"generate-and-verify",children:"Generate and Verify"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generate witness\nnode circuits/build/credit_score_js/generate_witness.js \\\n  circuits/build/credit_score_js/credit_score.wasm \\\n  test_input.json \\\n  witness.wtns\n\n# Generate proof\nsnarkjs groth16 prove \\\n  circuits/build/credit_score_final.zkey \\\n  witness.wtns \\\n  proof.json \\\n  public.json\n\n# Verify locally\nsnarkjs groth16 verify \\\n  circuits/build/verification_key.json \\\n  public.json \\\n  proof.json\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected Output:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[INFO]  snarkJS: OK!\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-6-export-soroban-verifier",children:"Step 6: Export Soroban Verifier"}),"\n",(0,r.jsx)(n.p,{children:"Generate Rust code for Stellar deployment:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Export Soroban contract\nsnarkjs zkey export soroban \\\n  circuits/build/credit_score_final.zkey \\\n  contracts/src/verifier.rs\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Output:"})," ",(0,r.jsx)(n.code,{children:"verifier.rs"})," with embedded verification key"]}),"\n",(0,r.jsx)(n.h3,{id:"customize-the-contract",children:"Customize the Contract"}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"contracts/src/lib.rs"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:'#![no_std]\nuse soroban_sdk::{contract, contractimpl, Env, Vec};\n\nmod verifier;\nuse verifier::verify_groth16;\n\n#[contract]\npub struct CreditScoreVerifier;\n\n#[contractimpl]\nimpl CreditScoreVerifier {\n    pub fn verify(env: Env, proof: Vec<u8>) -> bool {\n        // Call generated verifier\n        verify_groth16(&env, proof)\n    }\n\n    pub fn check_credit(env: Env, applicant: Address, proof: Vec<u8>) -> bool {\n        let valid = Self::verify(env.clone(), proof);\n\n        if valid {\n            log!(&env, "Credit check passed for: {}", applicant);\n        }\n\n        valid\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"step-7-deploy-to-stellar",children:"Step 7: Deploy to Stellar"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Build contract\ncd contracts\ncargo build --target wasm32-unknown-unknown --release\n\n# Optimize\nwasm-opt --strip-debug -Oz \\\n  target/wasm32-unknown-unknown/release/credit_score_verifier.wasm \\\n  -o verifier-optimized.wasm\n\n# Deploy\nsoroban contract deploy \\\n  --wasm verifier-optimized.wasm \\\n  --source YOUR_SECRET_KEY \\\n  --network testnet\n"})}),"\n",(0,r.jsx)(n.h2,{id:"advanced-techniques",children:"Advanced Techniques"}),"\n",(0,r.jsx)(n.h3,{id:"1-range-proofs",children:"1. Range Proofs"}),"\n",(0,r.jsx)(n.p,{children:"Prove a value is within a range:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"template RangeProof(n) {\n    signal input value;\n    signal input min;\n    signal input max;\n    signal output inRange;\n\n    component gte = GreaterEqThan(n);\n    component lte = LessEqThan(n);\n\n    gte.in[0] <== value;\n    gte.in[1] <== min;\n\n    lte.in[0] <== value;\n    lte.in[1] <== max;\n\n    inRange <== gte.out * lte.out;  // AND gate\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-set-membership",children:"2. Set Membership"}),"\n",(0,r.jsx)(n.p,{children:"Prove a value is in an allowed set:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"template SetMembership(setSize) {\n    signal input value;\n    signal input allowedValues[setSize];\n    signal output isMember;\n\n    component eq[setSize];\n    signal matches[setSize];\n\n    for (var i = 0; i < setSize; i++) {\n        eq[i] = IsEqual();\n        eq[i].in[0] <== value;\n        eq[i].in[1] <== allowedValues[i];\n        matches[i] <== eq[i].out;\n    }\n\n    // OR gate: at least one match\n    signal or[setSize];\n    or[0] <== matches[0];\n    for (var i = 1; i < setSize; i++) {\n        or[i] <== or[i-1] + matches[i] - (or[i-1] * matches[i]);\n    }\n\n    isMember <== or[setSize - 1];\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-merkle-tree-verification",children:"3. Merkle Tree Verification"}),"\n",(0,r.jsx)(n.p,{children:"Prove membership in a large set efficiently:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:'include "circomlib/circuits/poseidon.circom";\n\ntemplate MerkleTreeVerifier(levels) {\n    signal input leaf;\n    signal input pathElements[levels];\n    signal input pathIndices[levels];\n    signal input root;\n\n    component hashers[levels];\n    signal levelHashes[levels + 1];\n\n    levelHashes[0] <== leaf;\n\n    for (var i = 0; i < levels; i++) {\n        hashers[i] = Poseidon(2);\n\n        // Left or right based on path index\n        hashers[i].inputs[0] <== levelHashes[i] * (1 - pathIndices[i]) +\n                                  pathElements[i] * pathIndices[i];\n        hashers[i].inputs[1] <== pathElements[i] * (1 - pathIndices[i]) +\n                                  levelHashes[i] * pathIndices[i];\n\n        levelHashes[i + 1] <== hashers[i].out;\n    }\n\n    root === levelHashes[levels];\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,r.jsx)(n.h3,{id:"1-minimize-constraints",children:"1. Minimize Constraints"}),"\n",(0,r.jsx)(n.p,{children:"More constraints = larger proofs + slower generation."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Bad:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"signal intermediate1 <== a * b;\nsignal intermediate2 <== intermediate1 * c;\nsignal result <== intermediate2 * d;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Good:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"signal result <== a * b * c * d;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-use-efficient-components",children:"2. Use Efficient Components"}),"\n",(0,r.jsx)(n.p,{children:"Prefer built-in circomlib components:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Operation"}),(0,r.jsx)(n.th,{children:"Efficient"}),(0,r.jsx)(n.th,{children:"Inefficient"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Comparison"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GreaterThan"})}),(0,r.jsx)(n.td,{children:"Manual bit decomposition"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Hashing"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Poseidon"})}),(0,r.jsx)(n.td,{children:"SHA256 (many constraints)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Conditionals"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Mux1"})}),(0,r.jsx)(n.td,{children:"Custom if/else logic"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"3-batch-operations",children:"3. Batch Operations"}),"\n",(0,r.jsx)(n.p,{children:"Process multiple items in one circuit:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"template BatchVerifier(n) {\n    signal input values[n];\n    signal input minValues[n];\n    signal output allValid;\n\n    component checks[n];\n    signal results[n];\n\n    for (var i = 0; i < n; i++) {\n        checks[i] = GreaterEqThan(32);\n        checks[i].in[0] <== values[i];\n        checks[i].in[1] <== minValues[i];\n        results[i] <== checks[i].out;\n    }\n\n    // AND all results\n    signal and[n];\n    and[0] <== results[0];\n    for (var i = 1; i < n; i++) {\n        and[i] <== and[i-1] * results[i];\n    }\n\n    allValid <== and[n-1];\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing-best-practices",children:"Testing Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-unit-test-components",children:"1. Unit Test Components"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Test individual components\ncircom test_component.circom --test\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-integration-testing",children:"2. Integration Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import { wasm as wasm_tester } from "circom_tester";\n\ndescribe("Credit Score Circuit", function () {\n    let circuit;\n\n    before(async function () {\n        circuit = await wasm_tester("circuits/credit_score.circom");\n    });\n\n    it("should verify valid credit score", async function () {\n        const witness = await circuit.calculateWitness({\n            creditScore: "720",\n            minScore: "650"\n        });\n\n        await circuit.checkConstraints(witness);\n        await circuit.assertOut(witness, { scoreValid: 1 });\n    });\n\n    it("should reject invalid credit score", async function () {\n        const witness = await circuit.calculateWitness({\n            creditScore: "600",\n            minScore: "650"\n        });\n\n        await circuit.assertOut(witness, { scoreValid: 0 });\n    });\n});\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-fuzzing",children:"3. Fuzzing"}),"\n",(0,r.jsx)(n.p,{children:"Test with random inputs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"for (let i = 0; i < 1000; i++) {\n    const creditScore = Math.floor(Math.random() * 850);\n    const minScore = 650;\n\n    const witness = await circuit.calculateWitness({\n        creditScore: creditScore.toString(),\n        minScore: minScore.toString()\n    });\n\n    const expected = creditScore >= minScore ? 1 : 0;\n    await circuit.assertOut(witness, { scoreValid: expected });\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"1-soundness",children:"1. Soundness"}),"\n",(0,r.jsx)(n.p,{children:"Ensure constraints fully enforce your logic:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"// BAD: Doesn't constrain the result\nsignal output result;\nresult <-- a + b;  // <-- is unconstrained assignment\n\n// GOOD: Properly constrains\nsignal output result;\nresult <== a + b;  // <== adds constraint\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-underflowoverflow",children:"2. Underflow/Overflow"}),"\n",(0,r.jsx)(n.p,{children:"Be careful with field arithmetic:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"// Field elements wrap around\n// 0 - 1 = p - 1 (large number)\n\n// Use safe comparison\ncomponent gte = GreaterEqThan(32);\ngte.in[0] <== a;\ngte.in[1] <== b;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-input-validation",children:"3. Input Validation"}),"\n",(0,r.jsx)(n.p,{children:"Validate all inputs in constraints:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"template SafeCircuit() {\n    signal input age;\n    signal output valid;\n\n    // Ensure age is reasonable (0-150)\n    component rangeCheck = LessEqThan(8);\n    rangeCheck.in[0] <== age;\n    rangeCheck.in[1] <== 150;\n\n    valid <== rangeCheck.out;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,r.jsx)(n.h3,{id:"1-unconstrained-signals",children:"1. Unconstrained Signals"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"// BAD\nsignal x;\nx <-- a * b;  // x is not constrained!\n\n// GOOD\nsignal x;\nx <== a * b;  // x is constrained to equal a * b\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-division",children:"2. Division"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"// Division is not directly supported\n// Use inverse multiplication instead\n\nsignal inverse;\ninverse <== 1 / divisor;  // Computed off-circuit\ndivisor * inverse === 1;   // Constraint checks it's correct\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-non-deterministic-operations",children:"3. Non-Deterministic Operations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-circom",children:"// BAD: Random values\nsignal random <-- Math.random();\n\n// GOOD: Deterministic from inputs\nsignal hash <== Poseidon([input1, input2]);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"../stellar-integration/deployment",children:"Deploy to Stellar \u2192"})})," - Production deployment"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./performance",children:"Performance Optimization \u2192"})})," - Advanced optimization techniques"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./security",children:"Security Audit \u2192"})})," - Prepare for audit"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Questions?"})," ",(0,r.jsx)(n.a,{href:"https://github.com/xcapit/openzktool/discussions",children:"GitHub Discussions"})]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>o});var s=i(6540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);